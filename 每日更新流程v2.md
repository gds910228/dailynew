# 📝 每日更新流程 v2.0 - 按日期管理

## 🎯 核心改进

**问题解决：**
- ✅ 只处理指定日期的图片，不会混入其他日期
- ✅ 清晰的文件夹结构（每个日期一个文件夹）
- ✅ 简化的操作流程

## 📁 文件夹结构

```
assets/images/
├── 20260118/
│   ├── 图片1.jpg
│   ├── 图片2.jpg
│   └── ...
├── 20260119/
│   ├── 图片1.jpg
│   └── ...
└── 20260120/
    └── (新日期文件夹)
```

**重要：永远保持平铺结构，不要在根目录放图片文件**

---

## 🔄 每日更新流程（简化版）

### 步骤 1：创建日期文件夹并添加图片

```bash
# 在项目根目录执行
mkdir assets\images\20260120
```

然后将当天的所有图片复制到 `assets\images\20260120\` 文件夹中。

### 步骤 2：双击运行 `按日期添加文章.bat`

输入日期（如：`20260120`），脚本会：

1. ✅ 只扫描指定日期文件夹
2. ✅ 生成正确的 GitHub URL
3. ✅ 自动处理中文文件名
4. ✅ 保存 URL 到 `urls_20260120.txt`
5. ✅ 询问是否上传图片到 GitHub

### 步骤 3：上传图片到 GitHub

脚本会询问：
```
Upload 20260120 images to GitHub? (y/n):
```

输入 `y`，自动执行：
```bash
git add assets/images/20260120/
git commit -m "Add images for 20260120"
git push origin main
```

### 步骤 4：在 Web 后台创建文章

1. 打开 `admin/index.html`（或在浏览器中打开）
2. 复制 `urls_20260120.txt` 中的所有 URL
3. 粘贴到"图片URL"输入框
4. 填写文章信息：
   - **标题**：`2026年1月20日`
   - **描述**：简要描述（如：机器人、商航突破等）
   - **发布日期**：`2026-01-20`
5. 点击提交

### 步骤 5：提交 articles.json

Web 后台会更新 `data/articles.json`，推送到 GitHub：

```bash
git add data/articles.json
git commit -m "Add article for 2026-01-20"
git push origin main
```

### 步骤 6：验证小程序

打开微信小程序，下拉刷新，检查图片能正常显示。

---

## 📌 示例输出

运行 `按日期添加文章.bat` 后：

```
========================================
 Processing Date: 20260120
========================================

======================================================================
 Image URLs for 20260120
======================================================================

1. 价值-机器人、商航突破.jpg
   https://raw.githubusercontent.com/.../assets/images/20260120/%E4%BB%B7%E5%80%BC-...

2. 格兰-机器人、业绩超预期股.jpg
   https://raw.githubusercontent.com/.../assets/images/20260120/%E6%A0%BC%E5%85%B0-...

======================================================================
 Total: 7 images
======================================================================

[OK] URLs saved to: urls_20260120.txt

========================================
Upload 20260120 images to GitHub? (y/n):
```

---

## ⚠️ 重要注意事项

### 1. 文件夹命名规则
- ✅ 使用 8 位数字：`20260120`
- ✅ 对应实际日期：2026年1月20日
- ❌ 不要使用其他格式

### 2. 图片存放位置
- ✅ 必须放在对应日期文件夹：`assets/images/20260120/`
- ❌ 不要直接放在 `assets/images/` 根目录

### 3. 每天独立操作
- ✅ 每个日期文件夹独立处理
- ✅ 不会影响其他日期的数据
- ✅ 避免混乱和错误

### 4. 推送顺序
1. 先上传图片（步骤3）
2. 再更新 articles.json（步骤5）
3. 顺序错误会导致图片无法加载

---

## 🔧 手动命令方式

如果你想手动操作，可以直接使用 Python 脚本：

```bash
# 生成指定日期的 URL
python generate_urls_by_date.py 20260120

# 手动上传图片
git add assets/images/20260120/
git commit -m "Add images for 20260120"
git push origin main

# 然后在 Web 后台创建文章...
```

---

## 📊 与旧版本的对比

### 旧版本（generate-urls-v2.bat）：
- ❌ 扫描所有图片（包括其他日期）
- ❌ 容易混淆和出错
- ❌ 需要手动筛选 URL

### 新版本（按日期添加文章.bat）：
- ✅ 只处理指定日期
- ✅ 清晰明确
- ✅ 自动化程度高

---

## 🚨 故障排查

### 问题：找不到日期文件夹
**错误信息**：`[ERROR] Date folder not found: assets/images/20260120`

**解决方案**：
1. 检查文件夹是否存在：`ls assets/images/`
2. 创建文件夹：`mkdir assets\images\20260120`
3. 确保图片已放入该文件夹

### 问题：没有找到图片
**错误信息**：`[INFO] No images found in assets/images/20260120`

**解决方案**：
1. 检查文件夹中的文件格式
2. 确保是 .jpg、.png、.gif 等图片格式
3. 检查文件扩展名是否正确

### 问题：图片上传失败
**错误信息**：`[ERROR] Git push failed`

**解决方案**：
1. 检查网络连接
2. 检查 Git 凭证配置
3. 手动执行：`git push origin main`

---

## 💡 最佳实践

### 1. 定期整理
定期检查 `assets/images/` 文件夹，确保结构清晰：
```
assets/images/
├── 20260118/
├── 20260119/
├── 20260120/
└── ...
```

### 2. 备份数据
定期备份 `data/articles.json` 和 `assets/images/` 文件夹。

### 3. 验证发布
每次发布后，在小程序中验证：
- 封面图显示正常
- 详情页图片加载正常
- 所有图片都能查看

---

## 📌 总结

**新流程的优势：**
- ✅ 按日期隔离，不会混淆
- ✅ 操作简单，自动化程度高
- ✅ 错误率大幅降低
- ✅ 易于维护和管理

**记住：每天一个文件夹，运行一次脚本，完成一天的内容。**
